# os

- [데드락](#데드락)
- [뮤텍스 / 세마포어](뮤텍스(Mutex)--세마포어(Semaphore))
 
--- 

## 데드락
다수의 프로세스나 스레드가 서로가 보유하고 있는 자원을 요구하면서 무한히 대기하는 상태

### 필요조건
4가지 조건이 모두 성립해야 함
- 상호 배제 (Mutual Exclusion)
  - 프로세스끼리 자원 공유를 하지 않는다.
- 점유 대기 (Hold and Wait)
  - 프로세스가 이미 하나 이상의 자원을 취득한 상태에서, 다른 프로세스가 사용중인 자원을 추가로 기다린다. 
- 비선점 (No Preemption)
  - 자원 반환은, 오직 그 자원을 취득하고 있는 프로세스만 할 수 있다.
- 순환 대기 (Circular Wait)
  - 프로세스들이 순환하는 형태로 서로의 자원을 기다린다.

### 해결방법
#### 예방
데드락 필요조건 4가지 중 1개가 충족되지 않도록 설계
- 상호 배제 X
  - 모든 자원의 공유를 허용
- 점유 대기 X
  - 필요한 모든 자원을 할당
  - 자원을 취득하지 않은 상태에서만 자원을 요청하도록 설계
- 비선점 X
  - 자원을 강제로 뺏어갈 수 있도록 설계
- 순환 대기 X
  - 모든 자원에 순서를 부여해 순차적으로 자원을 요청하도록 설계

#### 회피
교착상태가 발생할 가능성이 있는 자원 할당을 하지 않고 안전한 상태에서만 자원 요청을 허용하는 방법
- 다음과 같은 가정이 필요
  - 프로세스 수 고정
  - 자원의 종류와 수가 고정
  - 프로세스가 요구하는 자원 및 최대 자원의 수를 알아야 함
  - 프로세스는 자원을 사용후 반납해야 한다.
- 자원 할당 그래프 알고리즘 (Resource-Allocation Graph Algorithm)
  - 자원 유형마다 인스턴스가 하나 있는 경우
- 은행원 알고리즘 (Banker's Algorithm)
  - 각 자원 유형마다 다수의 인스턴스를 갖는 경우

#### 복구
데드락을 허용하고, 데드락이 발생하면 복구
- 프로세스 종료
  - 교착상태의 모든 프로세스를 중지
  - 교착상태가 제거될 때까지 프로세스를 하나씩 중지
- 자원선점
  - 자원을 빼앗긴 프로세스는 강제 종류 이후 재시작
  - 교착 상태에 빠진 프로세스가 필요로 하는 자원을 강제로 가져옴

<br>

## 뮤텍스(Mutex) / 세마포어(Semaphore)
### 임계 구역(Critical section)
다수의 프로세스가 데이터를 공유하며 실행되는 상황에서 각 프로세스가 공유 자원에 접근하는 코드 블록

### 뮤텍스
- 하나의 스레드, 프로세스에 의해 소유될 수 있는 Key를 기반으로 한 상호배제기법
- 뮤텍스는 단 하나의 프로세스/스레드만 접근 가능하다.
- 사용중인 프로세스/스레드가 락을 걸어 다른 프로세스/스레드의 접근을 방지한다.
- 락을 건 대상이 아니면 해제가 불가능하다.
### 세마포어
- 어떤 공유 자원에 대해 동시에 접근할 수 있는 프로세스/스레드의 수(카운트)를 제한
- 세마포어의 값이 3이라면, 동시에 3개의 프로세스/스레드가 접근 가능
- 세마포어는 뮤텍스와는 다르게 소유권이 없어 누구나 획득 후 해제할 수 있다.

[위로](#spring)

<br>

[위로](#spring)
